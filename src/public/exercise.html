<!DOCTYPE html>
<html lang="ru">
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js" ></script>
    <script src="jquery.ba-throttle-debounce.min.js" ></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Personal security</title>
  <script defer src="/bundle.js"></script><link href="/app.css" rel="stylesheet"></head>
    <body>
      <div class="container  container-exercise">
        <!-- <div class="container container-article container-exercise"> -->

      <section class="navigator">
        <div class="nav_logo">
          <a class="nav_logo-link" href="/"><img id="nav_logo" src="./images/logo.svg" alt="Personal security"></a>
        </div>
        <ul class="nav_list">
          <li class="nav_item"><a href="course.html">Тренировки</a></li>
          <li class="nav_item active"><a href="theory.html">Теория</a></li>
          <li class="nav_item"><a href="situation.html">Ситуации</a></li>
        </ul>
        <div class="nav_list menu__wrapper">
          <div class="nav_el nav_menu nav_menu-btn" id="nav-menu-mob">
              <svg class="icons icons--menu" width="20" height="20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                <use xlink:href="sprite.svg#icon-menu"></use>
              </svg>
          </div>
          <div class="nav_list nav_list-menu hide" id="menu-nav">
            <div class="nav_el nav_search" id="open-search-btn">
              <svg class="icons icons--search" width="24" height="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                 <use xlink:href="sprite.svg#icon-search"></use>
              </svg>
              <div class="nav_list-text">Поиск</div>
            </div>
            <a class="nav_el nav_profile" href="profile.html">
              <svg class="icons icons--profile" width="24" height="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                 <use xlink:href="sprite.svg#icon-profile"></use>
              </svg>
              <div class="nav_list-text">Аккаунт</div>
            </a>
          </div>
        </div>
        <div class="search-panel hide" id="search-panel">
          <div class="search-input_wrapper">
            <input type="text" class="search__input" placeholder="Поиск" id="search_input">
            <div class="search-btn" id="search-btn">
              <svg class="icons icons--search" width="24" height="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                 <use xlink:href="sprite.svg#icon-search"></use>
              </svg>
            </div>
            <div class="clear-btn hide" id="clear-btn">
              <svg class="icons icons--clear" width="16" height="16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                 <use xlink:href="sprite.svg#icon-close"></use>
              </svg>
            </div>
          </div>
          <div class="search-panel-close" id="close-search-btn">
            <svg class="icons icons--close" width="24" height="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
               <use xlink:href="sprite.svg#icon-close"></use>
            </svg>
          </div>
        </div>
      </section>



      <section class="article article-exercise__wrapper">
          <div class="scrollbar__wrapper"></div>

          <div class="article-exercise">
          <div class="slide slide-first">
            <div class="slide__inner">

              <div class="block_top">
                <div class="block_return">
                  <a href="index.html">
                    <svg class="icons icons--return" width="44" height="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                       <use xlink:href="sprite.svg#icon-return"></use>
                    </svg>
                  </a>
                </div>
              </div>

              <div class="exercise_footer">
                <div class="descr">
                  <div class="type">Занятие</div>
                </div>
                <div class="exercise_footer-title">Регистрация мессенджеров на иностранные номера</div>
              </div>

            <div class="article-situation_header">
              <div class="header_inner">
                <h1>Резервное копирование</h1>
                <div class="about_exercise">
                  Все уроки lorem вот одна из задачек с этого экзамена. Её задавали на экзамене 2019 года. На рисунке вы видите треугольник. Также известна длина некоторых частей треугольника.
                </div>
                <div class="descr">
                  <div class="time">4 мин</div>
                  <div class="in-coaching hide">
                    <svg class="icons icons--profile" width="13" height="13" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                       <use xlink:href="sprite.svg#icon-profile"></use>
                    </svg>
                  </div>
                  <div class="done">
                     <svg class="icons icons--done" width="24" height="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <use xlink:href="sprite.svg#icon-done"></use>
                     </svg>
                  </div>
                </div>
                <div class="set_exercise"><span onClick="window.setList(this, 5)" class="link_txt-blue">Добавить</span> себе в тренировку</div>
              </div>
              <div class="descr-img" ><img src="https://d2vxx5bkl3bn4a.cloudfront.net/hi/надежные_пароли.svg" alt="Цифровая безопасность"></div>
            </div>
              <div class="block_scroll">
                  <svg class="icons icons--return" width="44" height="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                     <use xlink:href="sprite.svg#icon-return"></use>
                  </svg>
              </div>
          </div>

        </div>

       <div class="slide slide-text">
          <div class="slide__inner">
            <h3>Зачем это делать</h3>
            <div>Резервное <a href="">копирование</a> (бэкап) помогает, если ты случайно удалил или изменил важные данные, или данные уничтожил вирус, или информация потерялась при краже или поломке оборудования. Бэкапы бывают локальные (на съемных жестких дисках, флешках и сетевых хранилищах NAS) и "облачные", например, в Dropbox или Google Диске.</div>
            <div>Какой способ <span class="tooltip" onClick="showTooltip(this)">подходит тебе<span class="hide">описание термина вставляется в тултип</span></span>, зависит от твоей модели угроз, то есть от того, что и от кого ты защищаешь. Но есть и общие правила. Например, люди забывчивы, поэтому автоматические средства бэкапа (например, специальной утилитой в облако или сетевое хранилище) часто оказываются надежнее. Но если ты можешь позволить себе потерять последний месяц цифровой "жизни", тебе может подойти способ вручную копировать данные на съемный жесткий диск и хранить в ящике стола. "Облачное" хранение большого объема данных может быть не бесплатным, но цены на эту услугу постепенно снижаются (вот ссылки на цены хранения в облаке Google и Apple).</div>
            <figure class=""><img src="https://securno.s3.eu-central-1.amazonaws.com/ill/phish.jpg" alt="ill/phish.jpg" width="1000" height="662">
            <figcaption>Предупреждение браузера о переходе на фишинговую страницу</figcaption>
            </figure>
            <div>Какой способ подходит тебе, зависит от твоей модели угроз, то есть от того, что и от кого ты защищаешь. Но есть и общие правила. Например, люди забывчивы, поэтому автоматические средства бэкапа (например, специальной утилитой в облако или сетевое хранилище) часто оказываются надежнее. Но если ты можешь позволить себе потерять последний месяц цифровой "жизни", тебе может подойти способ вручную копировать данные на съемный жесткий диск и хранить в ящике стола. "Облачное" хранение большого объема данных может быть не бесплатным, но цены на эту услугу постепенно снижаются (вот ссылки на цены хранения в облаке Google и Apple).</div>
          </div>
        </div>
        <div class="slide slide-text">
           <div class="slide__inner">
             <h3>Зачем это делать</h3>
             <div>Резервное копирование (бэкап) помогает, если ты случайно удалил или изменил важные данные, или данные уничтожил вирус, или информация потерялась при краже или поломке оборудования. Бэкапы бывают локальные (на съемных жестких дисках, флешках и сетевых хранилищах NAS) и "облачные", например, в Dropbox или Google Диске.</div>
           </div>
         </div>

        <div class="slide slide-text">
          <div class="slide__inner">
            <h3>Как</h3>
            <div>При выборе системы резервного копирования ответь себе на вопросы:</div>
            <ul>
              <li>Какой объем важных данных не хочется потерять? От объема зависит стоимость хранения в облаке.</li>
              <li>Как часто изменяются эти данные? Если часто, это аргумент в пользу бэкапа автоматическими средствами.</li>
              <li>Как долго нужно хранить эти данные? Это не только о том, что надо хранить долго, но и о том, что должно исчезать. Например, некоторые облачные хранилища поддерживают бэкап  с "ротацией", то есть удалением старых резервных копий при создании новых.</li>
              <li>Нужно ли сохранять предыдущие версии изменившихся файлов? Если да, то стоит использовать системы резервного копирования с поддержкой версий. Например, их отлично поддерживает встроенная в Mac OS система TimeMachine и не всегда поддерживают облачные хранилища.</li>
              <li>Доверяешь ли ты содержание своих файлов самому облачному хранилищу? Если если тебе нужна гарантия, что сам сервис не сможет посмотреть твои данные и передать их третьим лицам - выбирай провайдеров с оконечным (end-to-end) шифрованием, например mega.io! Или установи на компьютер утилиту дополнительного шифрования. </li>
            </ul>
            <img src="./images/img_example/image_1.png" />
          </div>
        </div>
        <div class="slide">
          <div class="slide__inner">

            <div class="exercises_completed__wrapper">
              <img class="exercises_completed__img" src="./images/cup.svg" width="192" alt="">
              <h3 class="exercises_completed__header">Поздравляем!</h3>
              <div class="exercises_completed__text">Все занятия пройдены. Осталось немного практики. Выполните оставшиеся задания в <a href="todo.html">Туду-листе</a>, чтобы завершить тренировку.</div>
            </div>


            <div class="go_to_practice__wrapper-bg">
              <div class="go_to_practice__wrapper">
                <img class="go_to_practice__img" src="./images/go_to_practic.svg" alt="Цифровая безопасность">

                <div class="go_to_practice__inner">
                  <h3 class="go_to_practice__header">Готовы перейти к практике? Вот, что теперь можно сделать:</h3>
                  <ul class="go_to_practice__list-task">
                    <li class="go_to_practice__item-task"><a href="/course/tasks/" class="go_to_practice__item_link">Установить менеджер паролей</a> <span class="new_task">новое&nbsp;задание</span> <div class="btn-arrow_header"></div></li>
                  </ul>
                  <ul class="go_to_practice__list-section">
                    <li class="go_to_practice__item-section">
                      <a href="/course/tasks/" class="go_to_practice__item_link">Все мои задания&nbsp;&rarr;</a><br>
                      В туду-листе собираются задачи и инструкции по их выполнению
                    </li>

                  </ul>
                </div>


              </div>
            </div>

            <!--  ДЛЯ НЕЗАЛОГИНЕННЫХ  -->
            <!-- <div class="go_to_test__inner">
              <h3>Пройдите тест и мы составим для вас персональную программу тренировки по безопасности</h3>
              <a class="btn link_btn" href="">Настроить тренировку</a>
            </div> -->
            <!--  ДЛЯ ЗАЛОГИНЕННЫХ -->

            <div class="slide__inner-go_to_practice">
              <h3 >Следующее занятие</h3>
              <div class="exercise-instruction">
                <div class="go_to_practice__wrapper-bg go_to_practice__wrapper-bg-task">

                  <div class="go_to_practice__wrapper">

                    <img class="go_to_practice__img" src="./images/safety_img.png" alt="Цифровая безопасность">

                    <div class="go_to_practice__inner">
                      <div class="type black-70 font-11 mr-5 mb-10">Цифровая безопасность</div>
                      <h5>Настройки </h5>
                      <div class="descr">
                        <div class="time">4 мин</div>
                        <div class="in-coaching">
                          <svg class="icons icons--profile" width="13" height="13" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                             <use xlink:href="sprite.svg#icon-profile"></use>
                          </svg>
                        </div>
                      </div>

                    </div>
                  </div>
                </div>
                <a href="/theory/exercise/antivirus/" class="link"></a>
              </div>
            </div>

          </div>
        </div>



      </div>
      </section>

    </div>

    <footer class="hide">
      <div class="footer footer-main">
        <div class="footer_logo">
          <a class="footer_logo-link" href="/"><img src="./images/logo_small.svg" alt="Personal security" width="26" height="20"></a>
        </div>
        <ul class="footer_list">
          <li class="footer_item active"><a href="about.html">О проекте</a></li>
          <li class="footer_item active"><a href="/">Предложить новость</a></li>
        </ul>
      </div>
    </footer>



      <script>
        if ($(".article").find(".descr-img").length == 0) {
          $(".header_inner").css("width", "100%")
        }

        if (!($(".footer").hasClass('hide'))) {
          $('footer').addClass("hide")
        }

        let isExersiseRead = false // TODO получить с сервера состояние
        let bodyWidth = $('body').innerWidth()
        let arrSlideLength = $(".slide").length
        let scrollbarSection = $('<div class="scrollbar__section"></div>')
        let scrollbarWrapper = $(".scrollbar__wrapper")
        let heightSlide = $(".slide").height()
        let heightScrollbarSection = (heightSlide - 44) /arrSlideLength - 4
        let arrPoint = []
        let heightPoint = 0
        let MARGIN = 4
        let activeClass = 0

        scrollbarSection.css("height", heightScrollbarSection + "px")

        for (var i=0; i < arrSlideLength; i++) {
          scrollbarSection.clone().appendTo(scrollbarWrapper);
        }

        function setHeightScroll() { // установить высоту скролла и его элементов
          heightSlide = (activeClass == 0) ? $(".slide").height() : $(".container-exercise").height()
          heightScrollbarSection = (heightSlide - 44) /arrSlideLength - 4
          for (var i =0; i < ($(".scrollbar__section").length); i++) {
            $(".scrollbar__section").eq(i).css("height", heightScrollbarSection)
          }
        }

        setHeightScroll()

        function setPoint() { // получить точки для скролла
          arrPoint = []
          heightPoint = 0
          for (var i = 0; i < ($(".slide")).length; i++ ) {
            heightPoint = heightPoint + $(".slide").eq(i).outerHeight()
            if (i == ($(".slide")).length - 1) {
              heightPoint -= MARGIN
            }
            let el = {
              key: i,
              point: heightPoint
            }
            arrPoint.push(el)
          }
        }

        setPoint()

        $('.scrollbar__section').eq(activeClass).addClass("active")

        let scrollPos = 0;

        let pointStartScrollDown = $(".slide").eq(activeClass).find($(".slide__inner")).height() / 4
        let scrollDowm = true

        function onScrollArticle () {
          var blockScroll = $(".article-exercise").scrollTop()

          // if (bodyWidth >= 640 ) { // логика для скролла на планшете и десктопе
            if (blockScroll > scrollPos){
              scrollDowm = true
            } else {
              scrollDowm = false
            }
            scrollPos = blockScroll;

            if (scrollDowm) {
              if (pointStartScrollDown <= blockScroll) {
                pointStartScrollDown = 0
                $(".article-exercise").animate({
                  scrollTop: arrPoint[activeClass].point + 100
                }, 500);
                if (activeClass == 0) {
                  setPoint()
                }
                pointStartScrollDown = arrPoint[activeClass].point + $(".slide").eq(activeClass+1).find($(".slide__inner")).height()
              }

            } else {
              if (activeClass > 0) {
                pointStartScrollDown = arrPoint[activeClass-1].point + $(".slide").eq(activeClass).find($(".slide__inner")).height()
                  if ((blockScroll + MARGIN) < arrPoint[activeClass - 1].point) {
                    if (activeClass > 1) {
                      $(".article-exercise").animate({
                        scrollTop: arrPoint[activeClass-2].point
                      }, 500);
                    } else {
                      $(".article-exercise").animate({
                        scrollTop: ((blockScroll) - arrPoint[activeClass-1].point)
                      }, 500);
                    }
                  }
                  scrollDowm = true
                } else {
                  pointStartScrollDown = $(".slide").eq(activeClass).find($(".slide__inner")).height() / 4
                  scrollDowm = true
                }
              }
          // }


            if ((blockScroll + MARGIN)  >= arrPoint[activeClass].point) {
              $('.scrollbar__section').eq(activeClass).addClass("past")
              activeClass += 1
              $('.scrollbar__section').eq(activeClass).addClass("active")
              $(".slide").eq(activeClass).css("opacity", 1)
            }

          if ( activeClass > 0 ) {

            if (bodyWidth >= 1025 && !($(".navigator").hasClass('hide'))){
                $(".navigator").addClass('hide')
                $('.block_top').css("position", "fixed").css("top", "20px").css("left", "30px").css("display", "flex")
                $('.exercise_footer').css("display", "flex").css("left", "30px")
            }

            if (bodyWidth < 1025) {
              $('.block_top').css("display", "none")
              $('.exercise_footer').css("display", "none")
            }

            setPoint()

            if ((blockScroll + MARGIN) < arrPoint[activeClass - 1].point) {
              $(".slide").eq(activeClass).css("opacity", 0.25)
              $('.scrollbar__section').eq(activeClass).removeClass("active")
              $('.scrollbar__section').eq(activeClass).removeClass("past")
              activeClass -= 1

              $('.scrollbar__section').eq(activeClass).removeClass("past")
              $('.scrollbar__section').eq(activeClass).addClass("active")
              setHeightScroll()
              setPoint()
            }

        } else if (activeClass == 0) {
            if(bodyWidth >= 1025 && $(".navigator").hasClass('hide')){
                $(".navigator").removeClass('hide')
                $('.block_top').css("position", "relative").css("top", "0").css("left", "0")
                $('.exercise_footer').css("display", "none")
            }
            if (bodyWidth < 1025) {
              $('.block_top').css("display", "flex")
            }
          }
          setHeightScroll()

          let isInUserList = true // надо сначала получить
          if (!isExersiseRead && isInUserList) {
            if ((activeClass + 1) == arrSlideLength) {
                setExerciseRead()
            }
          }
        }
        
        $(".article-exercise").on('scroll', jQuery.throttle( 200, false, onScrollArticle ) );



        // $(".article-exercise").on('scroll', function(e) {
        //   e.preventDefault()
        //   onScrollArticle()
        // })

        function setExerciseRead () {
          isExersiseRead = true
            // const exerciseId = {{ exercise.id }};
            // const csrfmiddlewaretoken = $("[name=csrfmiddlewaretoken]")[0].value
            // $.post("{% url 'toggle_exercise' exercise.id %}", {
            //   'csrfmiddlewaretoken': csrfmiddlewaretoken,
            //   'check': true,
            // })
        }

          $(window).on("resize", function (e) {
            e.stopPropagation();
            bodyWidth = $('body').innerWidth()
            setHeightScroll()
            setPoint()
            onScrollArticle()
          })


          var popup = $('<div class="popup-tooptip hide"><span></span</div>')
          var btnClose = $('<div class="btn-close"><svg class="icons icons--close" width="16" height="16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="sprite.svg#icon-close"></use></svg></div>')
          btnClose.appendTo(popup)
          var elem

          $('body').on("click", function (e) {
             if ( e.target == popup.find($('span'))[0]) {
              return
             }
              if (e.target != elem ) {

                  popup.addClass("hide")
              }
            e.stopPropagation();
          })

          $(window).on("resize", function (e) {
            if (!popup.hasClass("hide")) {
              popup.addClass("hide")

            }
          })

          btnClose.on("click", function (e) {
            popup.addClass("hide")
          })

          function showTooltip (el) {
              elem = el
              popup.removeClass("hide")
              popup.appendTo($("body"))
              var left = $(el).offset().left
              var descr = $(el).find($(".hide")).text()
              popup.find($("span")).text(descr)
              var popupWidth = popup.width()
              var bodyWidth = $("body").width()

              var shift = bodyWidth - (left + 15 + popupWidth)
              if (shift < 0)  {
                left += shift
              }
              popup.css("top", ($(el).offset().top + 35))
              popup.css("left", left)
              isClickInner = false
            }

      </script>

    </body>
</html>
